<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>NeuralNetwork</title>

    <script src="../libraries/vis.js"></script>
    <script src="../libraries/util.js"></script>
    <script src="../libraries/convnet.js" type="text/javascript"></script>
    
    <script src="../libraries/p5.js" type="text/javascript"></script>
    <script src="../libraries/p5.dom.js" type="text/javascript"></script>
    
    <script src="../cifar/cifar10_labels.js" type="text/javascript"></script>
    
    <script src="../src/dataset.js" type="text/javascript"></script>
    <script src="../src/convnet.js" type="text/javascript"></script>
    <script src="../src/nnvis.js" type="text/javascript"></script>

    <script>
      var dataset;
      var convnet;
      var vis;
      var isTrained = false;

      function setup() {
        createCanvas(1280, 700);
        
        dataset = new dataset();
        dataset.loadCIFAR();
        
        convnet = new convnet(dataset);
        convnet.add_layer({type:'fc', num_neurons:15, activation:'sigmoid'});
        convnet.add_layer({type:'softmax', num_classes:10});
        convnet.setup();
        
        vis = new nnvis(convnet);
        vis.set_neuron_style(15, false);
        vis.set_draw_arrow(false);
        vis.set_rectangle(120, 50, 720, 420);
        vis.get_layer(1).set_maxn(15);
        vis.get_layer(1).set_neuron_style(12, false);
        vis.set_layer_style(0, vis.layer_draw_type.NORMAL, 25, 5, false);

        draw_net();
        /*confusion should just take the highest prob regardless if its wrong*/
      }

      function keyPressed() {
        if (key=='1') {
          convnet.train_next(50000);
          draw_net();

        }
        if (key=='2') {
          convnet.test_next(1);
          vis.update();
          draw_net();
        }

        if (key=='3') {
          isTrained = true;
        }

        if (key=='4') {
          convnet.test_next(50000);
          vis.update();
          draw_net();
        }
      }

      function mouseMoved() {
          //vis.process_mouse(mouseX, mouseY);
      }
      function draw() {
        if (isTrained) {
          if (frameCount % 120 == 0) {
            convnet.test_next(1);
            vis.update();
            draw_net();
          }
        }
      }

      function draw_net() {
        background(255);
        vis.draw_sample();
        vis.draw_network();
        vis.draw_result();
        //vis.draw_confusion();
      }
    </script>

    <style> body {padding: 0; margin: 0;} canvas {vertical-align: top;} </style>
  </head>
  <body>
  </body>
</html>
